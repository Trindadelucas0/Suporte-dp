<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            red: '#DC2626',
                            yellow: '#FBBF24'
                        },
                        'primary-red': '#DC2626',
                        'primary-yellow': '#FBBF24'
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon com as letras "DP" nas cores do sistema (Vermelho #DC2626 e Amarelo #FBBF24) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23DC2626;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23FBBF24;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='200' height='200' rx='20' fill='url(%23grad)'/%3E%3Ctext x='100' y='140' font-family='Arial, sans-serif' font-size='120' font-weight='bold' text-anchor='middle' fill='white'%3EDP%3C/text%3E%3C/svg%3E" />
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23DC2626;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23FBBF24;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='200' height='200' rx='20' fill='url(%23grad)'/%3E%3Ctext x='100' y='140' font-family='Arial, sans-serif' font-size='120' font-weight='bold' text-anchor='middle' fill='white'%3EDP%3C/text%3E%3C/svg%3E" />
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .gradient-text {
            background: linear-gradient(135deg, #DC2626 0%, #FBBF24 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dark-gradient-bg {
            background: linear-gradient(135deg, 
                #0a0a0a 0%, 
                #1a0a0a 25%, 
                #0a0a0a 50%, 
                #1a0a0a 75%, 
                #0a0a0a 100%
            );
        }

        .light-effects {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(220, 38, 38, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(251, 191, 36, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .icon-glow {
            filter: drop-shadow(0 0 10px rgba(220, 38, 38, 0.5)) drop-shadow(0 0 20px rgba(251, 191, 36, 0.3));
        }

        @keyframes slide-up {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes pulse-slow {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.6;
            }
        }

        .animate-slide-up {
            animation: slide-up 0.6s ease-out;
        }

        .animate-fade-in {
            animation: fade-in 0.8s ease-out;
        }

        .animate-pulse-slow {
            animation: pulse-slow 4s ease-in-out infinite;
        }

        .input-glow:focus {
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
        }
    </style>
</head>
<body class="dark-gradient-bg min-h-screen text-white relative overflow-x-hidden">
    <%- include('../partials/navbar') %>

    <main class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 py-4 sm:py-8 relative min-h-screen">
        <!-- Background Effects -->
        <div class="light-effects"></div>
        <div class="absolute top-10 left-10 w-96 h-96 bg-primary-red/10 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute bottom-10 right-10 w-96 h-96 bg-primary-yellow/10 rounded-full blur-3xl animate-pulse-slow"
            style="animation-delay: 2s;"></div>

        <div class="relative z-10">
            <!-- Header -->
            <div class="mb-8 animate-fade-in">
                <div class="flex items-center gap-4 mb-2">
                    <div class="relative">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-primary-red to-primary-yellow rounded-2xl blur-xl opacity-50">
                        </div>
                        <div class="relative bg-gradient-to-r from-primary-red to-primary-yellow rounded-2xl p-4">
                            <i class="fas fa-bell text-white text-4xl icon-glow"></i>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-4xl font-bold gradient-text">Notifica√ß√µes Administrativas</h1>
                        <p class="mt-2 text-white/70 text-lg">
                            Envie notifica√ß√µes para todos os usu√°rios ou para usu√°rios espec√≠ficos
                        </p>
                    </div>
                </div>
            </div>

            <!-- Formul√°rio de Nova Notifica√ß√£o -->
            <div class="glass rounded-2xl shadow-2xl p-4 sm:p-6 mb-6 sm:mb-8 border border-white/20 backdrop-blur-xl animate-slide-up">
                <div class="flex items-center mb-6">
                    <div class="relative mr-4">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-primary-yellow to-primary-red rounded-xl blur-lg opacity-50">
                        </div>
                        <div class="relative bg-gradient-to-r from-primary-yellow to-primary-red rounded-xl p-3">
                            <i class="fas fa-paper-plane text-white text-2xl"></i>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-white">Nova Notifica√ß√£o</h2>
                </div>
                <form id="formNotificacao" class="space-y-5">
                    <div>
                        <label for="titulo" class="block text-sm font-semibold text-white/90 mb-2">
                            <i class="fas fa-heading mr-2 text-primary-yellow"></i>T√≠tulo <span class="text-red-400">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="titulo" 
                            name="titulo" 
                            required
                            class="w-full px-4 py-3 glass-dark border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-red focus:border-primary-red transition-all input-glow backdrop-blur-sm"
                            placeholder="Ex: Lembrete: Fechamento de folha"
                        >
                    </div>

                    <div>
                        <label for="mensagem" class="block text-sm font-semibold text-white/90 mb-2">
                            <i class="fas fa-comment-alt mr-2 text-primary-yellow"></i>Mensagem <span class="text-red-400">*</span>
                        </label>
                        <textarea 
                            id="mensagem" 
                            name="mensagem" 
                            required
                            rows="4"
                            class="w-full px-4 py-3 glass-dark border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-red focus:border-primary-red transition-all input-glow backdrop-blur-sm resize-none"
                            placeholder="Digite a mensagem da notifica√ß√£o..."
                        ></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label for="tipo" class="block text-sm font-semibold text-white/90 mb-2">
                                <i class="fas fa-tag mr-2 text-primary-yellow"></i>Tipo <span class="text-red-400">*</span>
                            </label>
                            <select 
                                id="tipo" 
                                name="tipo" 
                                required
                                class="w-full px-4 py-3 glass-dark border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-primary-red focus:border-primary-red transition-all input-glow backdrop-blur-sm"
                            >
                                <option value="info" class="bg-gray-800">‚ÑπÔ∏è Info</option>
                                <option value="warning" class="bg-gray-800">‚ö†Ô∏è Aviso</option>
                                <option value="success" class="bg-gray-800">‚úÖ Sucesso</option>
                                <option value="error" class="bg-gray-800">‚ùå Erro</option>
                            </select>
                        </div>

                        <div>
                            <label for="destinatario" class="block text-sm font-semibold text-white/90 mb-2">
                                <i class="fas fa-user-friends mr-2 text-primary-yellow"></i>Destinat√°rio <span class="text-red-400">*</span>
                            </label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="buscarDestinatario" 
                                    placeholder="üîç Buscar usu√°rio por nome ou email..."
                                    class="w-full px-3 sm:px-4 py-2 glass-dark border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary-red focus:border-primary-red transition-all input-glow backdrop-blur-sm mb-2 text-sm sm:text-base"
                                    autocomplete="off"
                                    onkeyup="window.filtrarUsuarios(this.value)"
                                >
                                <select 
                                    id="destinatario" 
                                    name="destinatario" 
                                    required
                                    size="10"
                                    class="w-full px-3 sm:px-4 py-2 glass-dark border-2 border-white/20 rounded-xl focus:ring-2 focus:ring-primary-red focus:border-primary-red text-sm sm:text-base text-white backdrop-blur-sm"
                                    style="min-height: 250px; max-height: 300px;"
                                >
                                    <option value="todos" class="bg-gray-800">üì¢ Todos os usu√°rios</option>
                                    <% 
                                    let usuariosArray = [];
                                    
                                    if (typeof usuarios !== 'undefined' && usuarios !== null) {
                                        if (Array.isArray(usuarios)) {
                                            usuariosArray = usuarios;
                                        }
                                    }
                                    
                                    const usuariosNaoAdmin = usuariosArray.filter(u => {
                                        if (!u || !u.id) return false;
                                        const isAdmin = u.is_admin === true || 
                                                       u.is_admin === 'true' || 
                                                       u.is_admin === 1 || 
                                                       u.is_admin === 't' ||
                                                       String(u.is_admin).toLowerCase() === 'true';
                                        return !isAdmin;
                                    });
                                    %>
                                    <% if (usuariosArray.length > 0) { %>
                                        <% if (usuariosNaoAdmin.length > 0) { %>
                                            <% usuariosNaoAdmin.forEach(usuario => { %>
                                                <% if (usuario && usuario.id) { %>
                                                    <option 
                                                        value="<%= usuario.id %>" 
                                                        data-nome="<%= (usuario.nome || '').toLowerCase() %>" 
                                                        data-email="<%= (usuario.email || '').toLowerCase() %>"
                                                        class="bg-gray-800">
                                                        <%= usuario.nome || 'Sem nome' %> (<%= usuario.email || 'Sem email' %>)
                                                    </option>
                                                <% } %>
                                            <% }); %>
                                        <% } else { %>
                                            <option value="" disabled class="bg-gray-800">‚ö†Ô∏è Todos os usu√°rios cadastrados s√£o administradores</option>
                                        <% } %>
                                    <% } else { %>
                                        <option value="" disabled class="bg-gray-800">‚ùå Nenhum usu√°rio encontrado no sistema</option>
                                    <% } %>
                                </select>
                                <p class="text-xs text-white/60 mt-2" id="contadorUsuarios">
                                    <% 
                                    if (typeof usuarios !== 'undefined' && usuarios && Array.isArray(usuarios) && usuarios.length > 0) {
                                        const usuariosNaoAdmin = usuarios.filter(u => {
                                            if (!u || !u.id) return false;
                                            const isAdmin = u.is_admin === true || u.is_admin === 'true' || u.is_admin === 1;
                                            return !isAdmin;
                                        });
                                        if (usuariosNaoAdmin.length > 0) {
                                            %><%= usuariosNaoAdmin.length %> usu√°rio(s) dispon√≠vel(is)<%
                                        } else {
                                            %>‚ö†Ô∏è Todos os usu√°rios s√£o administradores<%
                                        }
                                    } else {
                                        %>‚ùå Nenhum usu√°rio encontrado no sistema<%
                                    }
                                    %>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button 
                            type="submit"
                            class="group relative px-8 py-3 bg-gradient-to-r from-primary-red to-primary-yellow text-white rounded-xl font-bold hover:shadow-2xl hover:shadow-primary-red/50 transition-all transform hover:scale-105 overflow-hidden"
                        >
                            <span class="relative z-10 flex items-center">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Enviar Notifica√ß√£o
                                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                            </span>
                            <div
                                class="absolute inset-0 bg-gradient-to-r from-primary-yellow to-primary-red opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Hist√≥rico -->
            <div class="glass rounded-2xl shadow-2xl p-6 border border-white/20 backdrop-blur-xl animate-slide-up"
                style="animation-delay: 0.1s;">
                <div class="flex items-center mb-6">
                    <div class="relative mr-4">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-primary-red to-primary-yellow rounded-xl blur-lg opacity-50">
                        </div>
                        <div class="relative bg-gradient-to-r from-primary-red to-primary-yellow rounded-xl p-3">
                            <i class="fas fa-history text-white text-2xl"></i>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-white">Hist√≥rico de Notifica√ß√µes</h2>
                </div>
                <% if (historico && historico.length > 0) { %>
                    <div class="space-y-4">
                        <% historico.forEach((notif, index) => { %>
                            <div class="glass-dark border-l-4 p-5 rounded-xl border-white/20 backdrop-blur-sm animate-slide-up"
                                style="animation-delay: <%= (index * 0.05) %>s; border-left-color: <%= 
                                    notif.tipo === 'info' ? 'rgba(59, 130, 246, 0.8)' :
                                    notif.tipo === 'warning' ? 'rgba(251, 191, 36, 0.8)' :
                                    notif.tipo === 'success' ? 'rgba(34, 197, 94, 0.8)' :
                                    'rgba(239, 68, 68, 0.8)' %>;">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <h3 class="font-bold text-white text-lg"><%= notif.titulo %></h3>
                                            <span class="px-3 py-1 rounded-full text-xs font-bold
                                                <%= notif.tipo === 'info' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                                                   notif.tipo === 'warning' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30' :
                                                   notif.tipo === 'success' ? 'bg-green-500/20 text-green-400 border border-green-500/30' :
                                                   'bg-red-500/20 text-red-400 border border-red-500/30' %>">
                                                <%= notif.tipo.toUpperCase() %>
                                            </span>
                                        </div>
                                        <p class="text-white/80 mt-2 mb-3"><%= notif.mensagem %></p>
                                        <div class="flex flex-wrap items-center gap-4 text-sm text-white/60">
                                            <div class="flex items-center">
                                                <i class="fas fa-user mr-2 text-primary-yellow"></i>
                                                <%= notif.usuario_nome || 'Todos os usu√°rios' %>
                                            </div>
                                            <div class="flex items-center">
                                                <i class="fas fa-clock mr-2 text-primary-yellow"></i>
                                                <%= new Date(notif.created_at).toLocaleString('pt-BR') %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-inbox text-6xl text-white/30 mb-4 block"></i>
                        <p class="text-white/50 text-lg">Nenhuma notifica√ß√£o enviada ainda.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <script>
        // Disponibiliza token CSRF globalmente
        window.csrfToken = '<%= typeof csrfToken !== "undefined" && csrfToken ? csrfToken : "" %>';
        
        function getCSRFHeaders() {
            const headers = { 'Content-Type': 'application/json' };
            if (window.csrfToken) {
                headers['X-CSRF-Token'] = window.csrfToken;
            }
            return headers;
        }

        // Fun√ß√£o para filtrar e destacar usu√°rios no select
        window.filtrarUsuarios = function(busca) {
            try {
                const select = document.getElementById('destinatario');
                if (!select) {
                    console.error('Select de destinat√°rio n√£o encontrado');
                    return;
                }

                const options = Array.from(select.querySelectorAll('option'));
                if (options.length === 0) {
                    console.warn('Nenhuma op√ß√£o encontrada no select');
                    return;
                }

                const buscaLower = (busca || '').toLowerCase().trim();
                let contador = 0;

                options.forEach(option => {
                    if (!option) return;

                    option.style.opacity = '';
                    option.style.fontWeight = '';
                    option.style.display = '';
                    option.style.visibility = '';
                    option.removeAttribute('hidden');
                    option.removeAttribute('disabled');
                    option.removeAttribute('data-hidden');

                    if (option.value === 'todos') {
                        if (buscaLower === '') contador++;
                    } else {
                        const nome = (option.getAttribute('data-nome') || '').toLowerCase();
                        const email = (option.getAttribute('data-email') || '').toLowerCase();
                        const texto = option.textContent.toLowerCase();
                        
                        const corresponde = buscaLower === '' || 
                            nome.includes(buscaLower) || 
                            email.includes(buscaLower) ||
                            texto.includes(buscaLower);

                        if (corresponde) {
                            contador++;
                            if (buscaLower !== '') {
                                option.style.backgroundColor = 'rgba(251, 191, 36, 0.2)';
                                option.style.fontWeight = '600';
                            }
                        } else if (buscaLower !== '') {
                            option.style.opacity = '0.4';
                        }
                    }
                });

                const contadorEl = document.getElementById('contadorUsuarios');
                if (contadorEl) {
                    if (buscaLower === '') {
                        const total = options.filter(o => o.value !== 'todos').length;
                        contadorEl.textContent = `${total} usu√°rio(s) dispon√≠vel(is)`;
                    } else {
                        contadorEl.textContent = `${contador} usu√°rio(s) encontrado(s)`;
                    }
                }
            } catch (error) {
                console.error('Erro ao filtrar usu√°rios:', error);
            }
        };

        // Limpa filtro ao selecionar
        document.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('destinatario');
            const buscarInput = document.getElementById('buscarDestinatario');
            
            console.log('üîç [CLIENTE] Verificando elementos de destinat√°rio...');
            console.log('üîç [CLIENTE] Select encontrado:', !!select);
            console.log('üîç [CLIENTE] Input encontrado:', !!buscarInput);
            
            if (!select) {
                console.error('‚ùå [CLIENTE] Select de destinat√°rio n√£o encontrado no DOMContentLoaded');
                return;
            }

            if (!buscarInput) {
                console.error('‚ùå [CLIENTE] Input de busca n√£o encontrado');
                return;
            }

            const options = Array.from(select.querySelectorAll('option'));
            console.log('üìã [CLIENTE] Total de op√ß√µes no select:', options.length);
            
            if (options.length === 0) {
                console.error('‚ùå [CLIENTE] Nenhuma op√ß√£o encontrada no select!');
            } else {
                console.log('‚úÖ [CLIENTE] Op√ß√µes encontradas:');
                options.forEach((opt, index) => {
                    if (index < 10) {
                        console.log(`  ${index + 1}. value="${opt.value}" - text="${opt.textContent.substring(0, 50)}" - disabled=${opt.disabled}`);
                    }
                });
                
                const opcoesUsuarios = options.filter(opt => opt.value !== 'todos' && !opt.disabled && opt.value !== '');
                console.log('üë• [CLIENTE] Op√ß√µes de usu√°rios dispon√≠veis (n√£o "todos" e n√£o disabled):', opcoesUsuarios.length);
                
                if (opcoesUsuarios.length === 0) {
                    console.warn('‚ö†Ô∏è [CLIENTE] Nenhum usu√°rio dispon√≠vel para sele√ß√£o!');
                } else {
                    console.log('‚úÖ [CLIENTE] Usu√°rios dispon√≠veis para sele√ß√£o:');
                    opcoesUsuarios.forEach((opt, index) => {
                        if (index < 5) {
                            console.log(`  ${index + 1}. ${opt.textContent}`);
                        }
                    });
                }
            }

            select.addEventListener('change', (e) => {
                const valorSelecionado = e.target.value;
                console.log('‚úÖ Usu√°rio selecionado:', valorSelecionado);
                
                if (valorSelecionado && valorSelecionado !== '') {
                    const opcaoSelecionada = Array.from(select.options).find(opt => opt.value === valorSelecionado);
                    if (opcaoSelecionada) {
                        console.log('‚úÖ Op√ß√£o encontrada:', opcaoSelecionada.textContent);
                    }
                }
            });

            select.addEventListener('click', (e) => {
                console.log('üñ±Ô∏è Select clicado');
                e.stopPropagation();
            });

            select.addEventListener('focus', () => {
                console.log('üëÅÔ∏è Select recebeu foco');
            });

            buscarInput.addEventListener('input', (e) => {
                window.filtrarUsuarios(e.target.value);
            });

            buscarInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    setTimeout(() => select.focus(), 100);
                }
            });

            select.style.pointerEvents = 'auto';
            select.style.cursor = 'pointer';
            select.style.userSelect = 'auto';

            const parentDiv = select.closest('.relative');
            if (parentDiv) {
                parentDiv.style.pointerEvents = 'auto';
            }

            window.filtrarUsuarios('');
            
            console.log('üîç [CLIENTE] Verificando dados do servidor...');
            const selectOptions = Array.from(select.querySelectorAll('option'));
            console.log('üîç [CLIENTE] Total de op√ß√µes renderizadas:', selectOptions.length);
            if (selectOptions.length <= 2) {
                console.error('‚ùå [CLIENTE] PROBLEMA: Apenas', selectOptions.length, 'op√ß√µes foram renderizadas!');
            }
        });

        document.getElementById('formNotificacao').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = {
                titulo: formData.get('titulo'),
                mensagem: formData.get('mensagem'),
                tipo: formData.get('tipo'),
                destinatario: formData.get('destinatario')
            };

            if (window.csrfToken) {
                data._csrf = window.csrfToken;
            }

            try {
                const headers = getCSRFHeaders();
                
                const response = await fetch('/admin/notificacoes/criar', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(data),
                    credentials: 'same-origin'
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erro ${response.status}: ${errorText}`);
                }

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    e.target.reset();
                    location.reload();
                } else {
                    alert('‚ùå Erro: ' + (result.error || 'Erro ao criar notifica√ß√£o'));
                }
            } catch (error) {
                console.error('Erro ao criar notifica√ß√£o:', error);
                alert('‚ùå Erro ao criar notifica√ß√£o: ' + error.message);
            }
        });
    </script>
</body>
</html>
