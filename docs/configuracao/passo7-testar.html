<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passo 7: Testar Sistema - Guia de Configura√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            position: relative;
            margin: 1rem 0;
        }
        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #4f46e5;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }
        .copy-btn:hover {
            background: #4338ca;
        }
        .copy-btn.copied {
            background: #10b981;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">7Ô∏è‚É£ Passo 7: Testar Sistema</h1>
                    <p class="text-gray-600">Testar webhooks e fluxo completo de ativa√ß√£o</p>
                </div>
                <a href="index.html" class="text-purple-600 hover:text-purple-700 font-semibold">‚Üê Voltar</a>
            </div>
        </div>

        <!-- Step 7.1 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üöÄ 7.1 - Iniciar Servidor</h2>
            <p class="text-gray-600 mb-4">
                Primeiro, certifique-se de que o servidor est√° rodando:
            </p>

            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this, 'START_SERVER')">Copiar</button>
                <code id="START_SERVER">npm run dev</code>
            </div>

            <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded mt-4">
                <p class="text-green-800">
                    <strong>‚úÖ Voc√™ deve ver:</strong> "Servidor rodando em http://localhost:3000" e 
                    "Conex√£o com PostgreSQL estabelecida"
                </p>
            </div>
        </div>

        <!-- Step 7.2 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üìß 7.2 - Testar Envio de Email</h2>
            <p class="text-gray-600 mb-4">
                Crie um arquivo de teste para verificar se o email est√° funcionando:
            </p>

            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this, 'TEST_EMAIL_CODE')">Copiar</button>
                <code id="TEST_EMAIL_CODE">// test-email.js
require('dotenv').config();
const EmailService = require('./services/emailService');

async function test() {
  console.log('üß™ Testando conex√£o SMTP...');
  const result = await EmailService.testConnection();
  
  if (result.success) {
    console.log('‚úÖ', result.message);
  } else {
    console.error('‚ùå Erro:', result.error);
  }
}

test();</code>
            </div>

            <p class="text-gray-600 mt-4">Execute:</p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this, 'RUN_TEST_EMAIL')">Copiar</button>
                <code id="RUN_TEST_EMAIL">node test-email.js</code>
            </div>
        </div>

        <!-- Step 7.3 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üîå 7.3 - Testar Webhook (Kiwify)</h2>
            <p class="text-gray-600 mb-4">
                Voc√™ pode testar o webhook usando curl ou uma ferramenta como Postman. 
                <strong>Nota:</strong> O teste sem assinatura v√°lida retornar√° erro 401, o que √© esperado.
            </p>

            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this, 'TEST_KIWIFY')">Copiar</button>
                <code id="TEST_KIWIFY">curl -X POST http://localhost:3000/webhook/kiwify \
  -H "Content-Type: application/json" \
  -H "X-Kiwify-Signature: teste" \
  -d '{
    "event": "order.paid",
    "data": {
      "id": "test-123",
      "customer": {
        "email": "teste@example.com",
        "name": "Cliente Teste"
      },
      "value": 100.00
    }
  }'</code>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mt-4">
                <p class="text-yellow-800">
                    <strong>‚ö†Ô∏è Nota:</strong> Este teste retornar√° erro 401 porque a assinatura n√£o √© v√°lida. 
                    Isso √© esperado! O webhook real da Kiwify ter√° uma assinatura v√°lida.
                </p>
            </div>
        </div>

        <!-- Step 7.4 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">‚úÖ 7.4 - Testar Fluxo Completo</h2>
            <p class="text-gray-600 mb-4">
                Para testar o fluxo completo, voc√™ precisa:
            </p>

            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">1. Fazer uma venda de teste</h3>
                    <p class="text-gray-600 text-sm">
                        Na plataforma (Kiwify/Hotmart/Kirvano), fa√ßa uma venda de teste ou use o modo sandbox.
                    </p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">2. Verificar logs do servidor</h3>
                    <p class="text-gray-600 text-sm">
                        Voc√™ deve ver mensagens como:
                    </p>
                    <div class="code-block mt-2">
                        <code>‚úÖ Link de ativa√ß√£o criado para: email@example.com (kiwify)
‚úÖ Email de ativa√ß√£o enviado: [messageId]</code>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">3. Verificar email recebido</h3>
                    <p class="text-gray-600 text-sm">
                        O cliente deve receber um email com o link de ativa√ß√£o.
                    </p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">4. Acessar link de ativa√ß√£o</h3>
                    <p class="text-gray-600 text-sm">
                        Clique no link do email e preencha o formul√°rio de cadastro.
                    </p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">5. Verificar usu√°rio criado</h3>
                    <p class="text-gray-600 text-sm">
                        Ap√≥s o cadastro, verifique no banco de dados se o usu√°rio foi criado:
                    </p>
                    <div class="code-block mt-2">
                        <code>SELECT * FROM users WHERE email = 'email@example.com';</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 7.5 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üêõ 7.5 - Troubleshooting</h2>
            
            <div class="space-y-4">
                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                    <p class="font-semibold text-red-800 mb-2">‚ùå Erro: "SMTP n√£o configurado"</p>
                    <p class="text-red-700 text-sm">
                        Verifique se todas as vari√°veis SMTP est√£o configuradas no .env
                    </p>
                </div>

                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                    <p class="font-semibold text-red-800 mb-2">‚ùå Erro: "Assinatura inv√°lida"</p>
                    <p class="text-red-700 text-sm">
                        Verifique se o secret do webhook est√° correto no .env e se o servidor foi reiniciado
                    </p>
                </div>

                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                    <p class="font-semibold text-red-800 mb-2">‚ùå Erro: "Link de ativa√ß√£o inv√°lido"</p>
                    <p class="text-red-700 text-sm">
                        Verifique se o token est√° correto e se o link n√£o expirou (7 dias)
                    </p>
                </div>

                <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                    <p class="font-semibold text-red-800 mb-2">‚ùå Email n√£o est√° sendo enviado</p>
                    <p class="text-red-700 text-sm">
                        Verifique logs do servidor, teste conex√£o SMTP, verifique se o email n√£o est√° na pasta de spam
                    </p>
                </div>
            </div>
        </div>

        <!-- Step 7.6 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üéâ 7.6 - Sistema Pronto!</h2>
            <p class="text-gray-600 mb-4">
                Se todos os testes passaram, seu sistema est√° pronto para uso em produ√ß√£o!
            </p>

            <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
                <p class="text-green-800 font-semibold mb-2">‚úÖ Checklist Final:</p>
                <ul class="list-disc list-inside text-green-700 space-y-1">
                    <li>Servidor rodando sem erros</li>
                    <li>Email sendo enviado corretamente</li>
                    <li>Webhooks configurados e funcionando</li>
                    <li>Links de ativa√ß√£o sendo gerados</li>
                    <li>Usu√°rios sendo criados ap√≥s cadastro</li>
                </ul>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between mt-8">
            <a href="passo6-kirvano.html" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg transition">
                ‚Üê Passo Anterior
            </a>
            <a href="index.html" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition">
                ‚úÖ Concluir Configura√ß√£o
            </a>
        </div>
    </div>

    <script>
        function copyCode(btn, codeId) {
            const codeElement = document.getElementById(codeId);
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'Copiado!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copiar';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
    </script>
</body>
</html>

